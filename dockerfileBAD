# Use the nixpacks Ubuntu base
FROM ghcr.io/railwayapp/nixpacks:ubuntu

# Install CA certificates
RUN apt-get update && \
    apt-get install -y ca-certificates && \
    update-ca-certificates && \
    rm -rf /var/lib/apt/lists/*

# Set Node.js to use system CA certificates
ENV NODE_EXTRA_CA_CERTS=/etc/ssl/certs/ca-certificates.crt

# Copy your application
WORKDIR /app
COPY . .

# Install dependencies and build
RUN npm ci --production=false && \
    npm run build

# Start the application
CMD ["npm", "run", "start"]